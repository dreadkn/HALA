/*
 * This file was generated by the Gradle 'init' task.
 */

plugins {
    id 'war'
    id 'idea'
    id 'java'
    id "com.ewerk.gradle.plugins.querydsl" version "1.0.10"
    id "com.github.node-gradle.node" version "3.2.1"
}

repositories {
    mavenCentral()
    jcenter()
    gradlePluginPortal()
}

ext {
    // 생성된 class 경로
    generatedJavaSourceDir = "src/generated/java"
}

/**
 * sourceSet에 generated add
 */
sourceSets {
    generated {
        java.srcDir generatedJavaSourceDir
    }
}

/**
 * 보통 src/main/java에 생성된 class는 generated class에 의존한다.
 * 이를 위한 의존관계 설정
 */
compileJava {
    source += sourceSets.generated.java
}

/**
 * intellij에 생성된 class가 sourceSet으로 인식되기 위한 설정
 */
idea {
    module {
        sourceDirs += sourceSets.generated.java.srcDirs
        generatedSourceDirs += sourceSets.generated.java.srcDirs
    }
}

//querydsl 추가 시작
def querydslDir = "$buildDir/generated/querydsl"

querydsl {
    jpa = true
    querydslSourcesDir = querydslDir
}

sourceSets {
    main.java.srcDir querydslDir
}

configurations {
    querydsl.extendsFrom compileClasspath
}

compileQuerydsl {
    options.annotationProcessorPath = configurations.querydsl
}

// task 등록
tasks.register("npm-install") {
    group = "application"
    description = "Installs dependencies from package.json"
    tasks.appNpmInstall.exec();
}

// npm install task
task appNpmInstall(type: NpmTask) {
    description = "Installs dependencies from pacakage.json"
    workingDir = file("${projectDir}/src/main/resources/static")
    args = ["install"]
}

dependencies {
    implementation 'org.springframework.boot:spring-boot-starter-web'
    implementation 'org.springframework.boot:spring-boot-starter-validation'
    implementation 'org.springframework.boot:spring-boot-starter-security'
    implementation 'org.springframework.boot:spring-boot-configuration-processor'
    implementation 'org.springframework.boot:spring-boot-starter-mail'
    implementation 'org.springframework.boot:spring-boot-starter-thymeleaf'
    implementation 'org.springframework.boot:spring-boot-starter-cache'
    implementation 'org.springframework.security:spring-security-taglibs:5.4.5'
    compile 'javax.servlet:jstl:1.2'
    implementation 'net.sargue:java-time-jsptags:1.1.4'
    implementation 'org.apache.tiles:tiles-jsp:3.0.8'
    implementation 'javax.cache:cache-api:1.1.1'
    implementation 'org.ehcache:ehcache:3.9.2'
    implementation 'com.auth0:java-jwt:3.10.3'
    implementation 'org.passay:passay:1.6.0'
    implementation 'org.jxls:jxls:2.8.1'
    implementation 'org.jxls:jxls-poi:2.8.1'

    implementation("com.querydsl:querydsl-jpa:${queryDslVersion}")
    implementation("com.querydsl:querydsl-apt:${queryDslVersion}")

    implementation 'com.drewnoakes:metadata-extractor:2.16.0'
    implementation 'org.projectlombok:lombok:1.18.18'
    implementation 'org.hibernate:hibernate-spatial:5.4.30.Final'
    implementation 'org.locationtech.jts:jts-core:1.17.1'
    implementation 'com.github.gavlyukovskiy:p6spy-spring-boot-starter:1.6.1'

    implementation 'org.webjars:vue:2.6.11'
    implementation 'org.webjars:AdminLTE:3.2.0'
    implementation 'org.webjars:Eonasdan-bootstrap-datetimepicker:4.17.47'
    implementation 'org.webjars.bower:bootstrap-fileinput:5.0.8'
    implementation 'org.webjars.bower:uri.js:1.17.1'
    implementation 'org.webjars.bower:github-com-macek-jquery-serialize-object:2.5.0'
    implementation 'org.webjars:dropzone:5.7.2'
    implementation group: 'org.modelmapper', name: 'modelmapper', version: '2.4.0'
    implementation group: 'kr.co.linkhub', name: 'popbill-sdk', version: '1.36.0'
    implementation group: 'com.twelvemonkeys.imageio', name: 'imageio-jpeg', version: '3.7.0'

    /*jeis start*/
    implementation "com.squareup.okhttp3:okhttp:4.9.3"
    implementation "com.squareup.okhttp3:okhttp-urlconnection:4.9.3"
    implementation "com.squareup.okhttp3:logging-interceptor:4.9.3"

    implementation "com.squareup.retrofit2:retrofit:2.9.0"
    implementation "com.squareup.retrofit2:adapter-rxjava2:2.9.0"
    implementation "com.squareup.retrofit2:converter-gson:2.9.0"
    implementation "com.squareup.retrofit2:converter-jackson:2.9.0"
    implementation 'com.squareup.retrofit2:converter-scalars:2.9.0'
    implementation 'org.apache.commons:commons-text:1.9'
    /*jeis end */

    /*popbill*/
    implementation 'kr.co.linkhub:popbill-sdk:1.54.0'

    /**
     * fcm support
     */
    implementation group: 'com.google.code.gson', name: 'gson', version: '2.8.9'
    implementation 'com.google.firebase:firebase-admin:8.1.0'

    compile('org.springframework.boot:spring-boot-starter-data-redis:2.4.4')
    compile 'org.apache.tomcat.embed:tomcat-embed-jasper:9.0.41'
    // 종속성 관리 플러그인을 사용중이라면
    ext['log4j2.version'] = '2.17.1'
    //종속성 관리 플러그인이 아닌 gradle 플랫폼을 사용하는 경우
    implementation(platform("org.apache.logging.log4j:log4j-bom:2.17.1"))
    // https://mvnrepository.com/artifact/org.apache.logging.log4j/log4j-api
    implementation group: 'org.apache.logging.log4j', name: 'log4j-api', version: '2.17.1'
    // https://mvnrepository.com/artifact/org.apache.logging.log4j/log4j-to-slf4j
    implementation group: 'org.apache.logging.log4j', name: 'log4j-to-slf4j', version: '2.17.1'

    // check for output war error
    runtimeOnly 'org.springframework.boot:spring-boot-devtools'
    /*end disable*/

    runtimeOnly 'com.h2database:h2:1.4.200'
    runtimeOnly 'mysql:mysql-connector-java:8.0.23'

    compileOnly group: 'org.projectlombok', name: 'lombok', version: '1.18.12'
    annotationProcessor("org.projectlombok:lombok")
    annotationProcessor "org.springframework.boot:spring-boot-configuration-processor"

    providedRuntime('org.springframework.boot:spring-boot-starter-tomcat')

    providedCompile 'javax.servlet:javax.servlet-api:4.0.0'
    providedCompile 'javax.servlet.jsp:javax.servlet.jsp-api:2.3.1'


    testImplementation 'org.springframework.boot:spring-boot-starter-test:2.4.1'

    // make pdf
    implementation 'com.itextpdf:itextpdf:5.5.13.3'
    implementation 'org.xhtmlrenderer:flying-saucer-pdf:9.1.22'

    // https://mvnrepository.com/artifact/org.apache.pdfbox/pdfbox
    implementation 'org.apache.pdfbox:pdfbox:2.0.26'
    // https://mvnrepository.com/artifact/org.apache.pdfbox/pdfbox-tools
    implementation 'org.apache.pdfbox:pdfbox-tools:2.0.26'

    // https://mvnrepository.com/artifact/com.github.node-gradle.node/com.github.node-gradle.node.gradle.plugin
    implementation group: 'com.github.node-gradle.node', name: 'com.github.node-gradle.node.gradle.plugin', version: '3.2.1', ext: 'pom'


}

